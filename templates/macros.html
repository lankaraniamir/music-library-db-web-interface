{# templates/macros.html #}

<!-- https://shubhamjain.co/2018/09/17/capitalizing-first-letter-in-jinja/ -->
{% macro capitalize(text) %}{{ text[0]|upper }}{{ text[1:] }}{% endmacro %}

{% macro f_capitalize(text, caps=True) %}
    {% if caps %}
        {{ capitalize(text) }}
    {% else %}
        {{ text }}
    {% endif %}
{% endmacro %}

{% macro display_val(value) %}
    {% if value == None %}
        -
    {% elif value == True %}
        ❤️
    {% elif value == False %}
        ♡️
    {% elif value is string %}
        {{capitalize(value)}}
    {% else %}
        {{value}}
    {% endif %}
{% endmacro %}

{% macro label_column(col) %}
    {{ col|replace("_", " ")|capitalize }}
{% endmacro %}

{% macro reference(page, param=None, text=None, caps=False)%}
    {% if param == None and text == None %}
        <a href="{{ url_for(page) }}">{{ f_capitalize(page, caps=caps) }}</a>
    {% elif param != None and text == None %}
        <a href="{{ url_for(page, var=param) }}" >{{ f_capitalize(param, caps=caps) }}</a>
    {% elif param == None %}
        <a href="{{ url_for(page) }}">{{ f_capitalize(text, caps=caps) }}</a>
    {% else %}
        <a href="{{ url_for(page, var=param) }}">{{ f_capitalize(text, caps=caps) }}</a>
    {% endif %}
{% endmacro %}

{% macro list_references(values, page, title=parameter, null_text=None, attribute=None) %}
    <section>
    {% if values %}
        {% if title %}
            <b>{{title}}</b>
        {% endif %}
        {% for val in values %}
            {% if attribute %}
                <li>{{ reference(page, param=val[attribute]) }}</li>
            {% else %}
                <li>{{ reference(page, param=val) }}</li>
            {% endif %}
        {% endfor %}
    {% elif null_text != None %}
        <b>{{null_text}}</b>
    {% endif %}
    </section>
    &nbsp
{% endmacro %}

{% macro display_all_as_table(entity, columns, references) %}
{% if not entity %}
    <p>No data to display.</p>
{% else %}
<table>
    <tr>
        {% for col in columns %}
            <th>{{ label_column(col) }}</th>
        {% endfor %}
    </tr>
    {% for row in entity %}
        <tr>
        {% for col in columns %}<td>
            {{ loop.index0 }}
            {% if references[loop.index0] == None %}
                {{ display_val(row[col]) }}
            {% else %}
                {% set group = references[loop.index0] %}
                {{ reference('song', param='Teehee') }}
            {% endif %}
        </td>{% endfor %}
        </tr>
    {% endfor %}
</table>
{% endif %}
{% endmacro %}

{% macro nav_link(menu_item) %}
    {% if menu_item == "user" %}
        {{ reference('user', param=session['username'], caps=True) }}
    {% else %}
        {{ reference(menu_item, caps=True) }}
    {% endif %}

    {% if request.endpoint == menu_item %}
        ←
    {% endif %}
{% endmacro %}